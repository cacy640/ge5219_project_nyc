# Spatiotemporal characteristics analysis and black spot detection of traffic accidents in New York City

INTRODUCTION
------------
This folder contains the codes used for all four types of analysis, namely Kernel Density Estimation, Hotspot Analysis,Spatial Autocorrelation, and Black Spot Analysis.
* main.py is to generate the gui for visualizing our dataset and results
* Kdens.py defines the functions for KDE (embedded in main.py)
* Hotspot.py defines the functions for Hotspot Analysis (embedded in main.py)
* BlackSpotAnalysis defines the functions for Black Spot Analysis (embedded in main.py)


REQUIREMENT
-----------
1. Must run in ArcGIS Pro Python interpreter that provides ArcPy license
2. Must enter Mapbox API token (free) and Mapbox image save path
3. Python version must be > Python 3.6.9
4. Need to make a .gdb and a .aprx (with a map layout)
5. The first chunk of code in main.py (ArcPy Workflow) must be executed for the first time when running main.py


USERS INPUT
----------
1. Mapbox API for the basemap of black spot analysis
2. image save path for Mapbox
3. dir_path: where the py files are located
4. arcpy.env.workspace: the .gdb file location
5. datapath: where the datasets (csv files) are located


ANALYSIS FUNCTIONS
------------------
1. KDens functions
    This is a function to calculate the Kernel Density Estimation for selected time period.
    All functions in KDens.py has the same syntactic and semantic structure.
    * Example:
        KDensall(filename, mask, in_path, output_path, m, aprx) [time period is pre-defined in datasets]
        - filename: text string, the name of csv file that is employed in this analysis
        - mask: the shapefile used to clip the output raster
        - in_path: the location path of [filename]
        - output_path: the path to save the result
        - m: the map layer in aprx file
        - aprx: the aprx file used in this analysis
2. Hotspot functions
    This is a function to calculate the Hotspot Analysis for selected time period.
    All functions in KDens.py has the same syntactic and semantic structure.
    * Example:
        Hotspotall(filename, mask, in_path, output_path, m, aprx) [time period is pre-defined in datasets]
        - filename: text string, the name of csv file that is employed in this analysis
        - mask: the shapefile used to clip the output raster
        - in_path: the location path of [filename]
        - output_path: the path to save the result
        - m: the map layer in aprx file
        - aprx: the aprx file used in this analysis
3. blackspot function
    This is a function to calculate the Black Spot Analysis for selected time period.
    * blackspot(filename, datapath, output_path)
        - filename: text string, the name of csv file that is employed in this analysis
        - datapath: the location path of [filename]
        - output_path: the path to save the result


OUTPUT
------
1. For KDE, Hotspot analysis, and Black Spot analysis, the gui will pop up a map dialog that shows the result of analysis.
    The images can be found in the working directory folder defined by the user.
2. For spatial autocorrelation, the gui will pop up a message dialog that illustrates the result.
    The report generated by ArcPy can be found in the path printed in the python console.
3. Docstrings can be found in the .py files
4. A video demonstration can be found here https://www.youtube.com/watch?v=TtfLtHXYB-E

